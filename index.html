<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Biology Dictionary (Bangla)</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #000;
      color: #fff;
    }

    .title-bar {
      background-color: #005f73;
      color: white;
      text-align: center;
      padding: 12px;
      font-size: 20px;
      font-weight: bold;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }

    .header {
      display: flex;
      align-items: center;
      padding: 10px;
      background-color: #111;
      justify-content: space-between;
    }

    .menu-btn {
      font-size: 24px;
      cursor: pointer;
      margin-right: 15px;
    }

    .search-bar {
      flex: 1;
      padding: 8px;
      background-color: #222;
      border: none;
      color: white;
      border-radius: 5px;
    }

    .search-btn {
      margin-left: 10px;
      padding: 8px 14px;
      background-color: #444;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .add-icon {
      font-size: 24px;
      cursor: pointer;
      color: #4fc3f7;
      margin-left: 15px;
    }

    .sidebar {
      position: fixed;
      top: 0;
      left: -250px;
      width: 240px;
      height: 100%;
      background-color: #101820;
      padding-top: 60px;
      transition: 0.3s;
    }

    .sidebar.active {
      left: 0;
    }

    .sidebar a {
      padding: 12px 20px;
      text-decoration: none;
      display: block;
      color: white;
      border-bottom: 1px solid #333;
    }

    .sidebar a:hover {
      background-color: #333;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      display: none;
    }

    .overlay.active {
      display: block;
    }

    .main {
      padding: 20px;
    }

    .add-word-form {
      background-color: #222;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      display: none;
      position: relative;
    }

    .add-word-form h2 {
      color: #4fc3f7;
      margin-top: 0;
    }

    .add-word-form .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 20px;
      cursor: pointer;
      color: #aaa;
    }

    .add-word-form .close-btn:hover {
      color: #fff;
    }

    .add-word-form label {
      display: block;
      margin-top: 10px;
    }

    .add-word-form input, .add-word-form textarea {
      width: 100%;
      padding: 8px;
      background-color: #333;
      border: none;
      color: white;
      border-radius: 5px;
      margin-top: 5px;
    }

    .add-word-form button {
      margin-top: 15px;
      padding: 8px 14px;
      background-color: #444;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .success-message {
      color: green;
      margin-top: 10px;
    }

    .error-message {
      color: red;
      margin-top: 10px;
    }

    .definition {
      background-color: #222;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
    }

    .definition h2 {
      margin-top: 0;
      color: #4fc3f7;
    }

    .example {
      color: #aaa;
      font-style: italic;
      margin-top: 10px;
    }

    .not-found {
      color: red;
      margin-top: 20px;
    }

    .suggestions {
      margin-top: 10px;
      background-color: #1a1a1a;
      border-radius: 5px;
      padding: 10px;
    }

    .suggestion-item {
      padding: 6px 10px;
      cursor: pointer;
      border-bottom: 1px solid #333;
    }

    .suggestion-item:hover {
      background-color: #333;
    }
  </style>
</head>
<body>
  <!-- Title Bar -->
  <div class="title-bar">
    <span class="icon">üî¨</span>
    <span>Biology Dictionary (Bangla)</span>
  </div>

  <!-- Header -->
  <div class="header">
    <span class="menu-btn" onclick="openSidebar()">‚ò∞</span>
    <input type="text" id="searchInput" class="search-bar" placeholder="Search word..." onkeyup="showSuggestions()">
    <button class="search-btn" onclick="searchWord()">Search</button>
    <span class="add-icon" onclick="showAddWordForm()">‚úö</span>
  </div>

  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <a href="#" onclick="showMain()">Home</a>
    <a href="#">Bookmark</a>
    <a href="#">History</a>
    <a href="#">Games</a>
    <a href="#" onclick="showAddWordForm()">Add Word</a>
    <a href="#">Settings</a>
    <a href="#">Backup</a>
    <a href="#">Restore</a>
    <a href="#">Contact</a>
  </div>

  <!-- Overlay -->
  <div class="overlay" id="overlay" onclick="closeSidebar()"></div>

  <!-- Main -->
  <div class="main" id="mainContent">
    <div id="suggestionBox" class="suggestions"></div>
    <div id="resultArea"></div>
    <div id="addWordForm" class="add-word-form">
      <span class="close-btn" onclick="closeAddWordForm()">√ó</span>
      <h2>Add New Word</h2>
      <label for="newWord">Word:</label>
      <input type="text" id="newWord" placeholder="Enter word">
      <label for="newMeaning">Meaning:</label>
      <textarea id="newMeaning" placeholder="Enter meaning"></textarea>
      <label for="newBreakdown">Structure:</label>
      <input type="text" id="newBreakdown" placeholder="Enter structure">
      <label for="newExample">Example:</label>
      <textarea id="newExample" placeholder="Enter example"></textarea>
      <button onclick="addWord()">Submit</button>
      <div id="formMessage"></div>
    </div>
  </div>

  <!-- JavaScript -->
  <script src="./dictionary.js"></script>
  <script>
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");
    const mainContent = document.getElementById("mainContent");
    const addWordForm = document.getElementById("addWordForm");
    const resultArea = document.getElementById("resultArea");
    const suggestionBox = document.getElementById("suggestionBox");

    // Back4app API configuration
    const APP_ID = 'ajoJF5djJIbi5BgETu5XMYh48GTayCJx2uQi3dzO';
    const API_KEY = 'Tfh8T9FEImgQbVJmkeTLFbRYIWcjyyEcrDxq09dS';
    const BACK4APP_API_URL = 'https://parseapi.back4app.com/classes/Words';

    let localWords = JSON.parse(localStorage.getItem('localWords')) || [];
    let combinedDictionary = [...dictionary, ...localWords];

    function openSidebar() {
      sidebar.classList.add("active");
      overlay.classList.add("active");
    }

    function closeSidebar() {
      sidebar.classList.remove("active");
      overlay.classList.remove("active");
    }

    function showMain() {
      addWordForm.style.display = "none";
      resultArea.style.display = "block";
      suggestionBox.style.display = "block";
      closeSidebar();
    }

    function showAddWordForm() {
      addWordForm.style.display = "block";
      resultArea.style.display = "none";
      suggestionBox.style.display = "none";
      closeSidebar();
    }

    function closeAddWordForm() {
      addWordForm.style.display = "none";
      showMain();
    }

    function showSuggestions() {
      const input = document.getElementById("searchInput").value.trim().toLowerCase();
      suggestionBox.innerHTML = "";

      if (input.length === 0) return;

      const matches = combinedDictionary.filter(entry =>
        entry.word.toLowerCase().includes(input)
      );

      if (matches.length > 0) {
        matches.forEach(entry => {
          const item = document.createElement("div");
          item.className = "suggestion-item";
          item.textContent = entry.word;
          item.onclick = () => {
            document.getElementById("searchInput").value = entry.word;
            suggestionBox.innerHTML = "";
            searchWord();
          };
          suggestionBox.appendChild(item);
        });
      }
    }

    function searchWord() {
      const input = document.getElementById("searchInput").value.trim().toLowerCase();
      resultArea.innerHTML = "";
      suggestionBox.innerHTML = "";

      let result = combinedDictionary.find(entry => entry.word.toLowerCase() === input);

      if (!result) {
        fetch(`${BACK4APP_API_URL}?where=${encodeURIComponent(JSON.stringify({ word: { $regex: `^${input}$`, $options: 'i' } }))}`, {
          headers: {
            'X-Parse-Application-Id': ajoJF5djJIbi5BgETu5XMYh48GTayCJx2uQi3dzO,
            'X-Parse-REST-API-Key': Tfh8T9FEImgQbVJmkeTLFbRYIWcjyyEcrDxq09dS,
          },
        })
        .then(response => response.json())
        .then(data => {
          if (data.results && data.results.length > 0) {
            result = data.results[0];
            combinedDictionary.push(result);
            localStorage.setItem('localWords', JSON.stringify(localWords.concat(result)));
          }
          if (result) {
            displayResult(result);
          } else {
            resultArea.innerHTML = `<p class="not-found">‚ùå Sorry, word not found.</p>`;
          }
        })
        .catch(error => {
          console.error('Error searching word from server:', error);
          resultArea.innerHTML = `<p class="not-found">‚ùå Sorry, word not found or server error.</p>`;
        });
      } else {
        displayResult(result);
      }
    }

    function displayResult(result) {
      resultArea.innerHTML = `
        <div class="definition">
          <h2>${capitalize(result.word)}</h2>
 <p><b><strong>Structure:</strong> ${result.breakdown}</b></p>
          <p><strong>Meaning:</strong> ${result.meaning}</p>
          <p class="example">Example: ${result.example}</p>
        </div>
      `;
    }

    function addWord() {
      const word = document.getElementById("newWord").value.trim();
      const meaning = document.getElementById("newMeaning").value.trim();
      const breakdown = document.getElementById("newBreakdown").value.trim();
      const example = document.getElementById("newExample").value.trim();
      const formMessage = document.getElementById("formMessage");

      if (!word || !meaning || !breakdown || !example) {
        formMessage.innerHTML = '<p class="error-message">Please fill in all fields.</p>';
        return;
      }

      const newWord = { word, meaning, breakdown, example };

      fetch(`${BACK4APP_API_URL}?where=${encodeURIComponent(JSON.stringify({ word: { $regex: `^${word}$`, $options: 'i' } }))}`, {
        headers: {
          'X-Parse-Application-Id': APP_ID,
          'X-Parse-REST-API-Key': API_KEY,
        },
      })
      .then(response => response.json())
      .then(data => {
        if (data.results && data.results.length > 0) {
          formMessage.innerHTML = '<p class="error-message">Word already exists on server.</p>';
        } else {
          fetch(BACK4APP_API_URL, {
            method: 'POST',
            headers: {
              'X-Parse-Application-Id': APP_ID,
              'X-Parse-REST-API-Key': API_KEY,
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(newWord),
          })
          .then(response => response.json())
          .then(data => {
            if (data.objectId) {
              formMessage.innerHTML = '<p class="success-message">Word added successfully to server!</p>';
              combinedDictionary.push(newWord);
              localStorage.setItem('localWords', JSON.stringify(localWords.concat(newWord)));
              clearForm();
              showMain(); // ‡¶´‡¶∞‡ßç‡¶Æ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶® ‡¶™‡ßá‡¶ú‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶ì
            } else {
              localWords.push(newWord);
              localStorage.setItem('localWords', JSON.stringify(localWords));
              combinedDictionary = [...dictionary, ...localWords];
              formMessage.innerHTML = '<p class="success-message">Word added locally due to server error.</p>';
              clearForm();
              showMain(); // ‡¶´‡¶∞‡ßç‡¶Æ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶® ‡¶™‡ßá‡¶ú‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶ì
            }
          })
          .catch(error => {
            localWords.push(newWord);
            localStorage.setItem('localWords', JSON.stringify(localWords));
            combinedDictionary = [...dictionary, ...localWords];
            formMessage.innerHTML = '<p class="success-message">Word added locally due to network error.</p>';
            clearForm();
            showMain(); // ‡¶´‡¶∞‡ßç‡¶Æ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶® ‡¶™‡ßá‡¶ú‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶ì
          });
        }
      })
      .catch(error => {
        localWords.push(newWord);
        localStorage.setItem('localWords', JSON.stringify(localWords));
        combinedDictionary = [...dictionary, ...localWords];
        formMessage.innerHTML = '<p class="success-message">Word added locally due to network error.</p>';
        clearForm();
        showMain(); // ‡¶´‡¶∞‡ßç‡¶Æ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶® ‡¶™‡ßá‡¶ú‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶ì
      });
    }

    function clearForm() {
      document.getElementById("newWord").value = "";
      document.getElementById("newMeaning").value = "";
      document.getElementById("newBreakdown").value = "";
      document.getElementById("newExample").value = "";
    }

    function capitalize(word) {
      return word.charAt(0).toUpperCase() + word.slice(1);
    }

    function loadDictionaryFromServer() {
      fetch(BACK4APP_API_URL, {
        headers: {
          'X-Parse-Application-Id': APP_ID,
          'X-Parse-REST-API-Key': API_KEY,
        },
      })
      .then(response => response.json())
      .then(data => {
        if (data.results) {
          localWords = JSON.parse(localStorage.getItem('localWords')) || [];
          combinedDictionary = [...dictionary, ...localWords, ...data.results];
        }
      })
      .catch(error => console.error('Error loading dictionary from server:', error));
    }

    window.onload = loadDictionaryFromServer;
  </script>
</body>
</html>
